<!DOCTYPE html>
<html lang="en"><head prefix="og: http://ogp.me/ns#">
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Mozcode Blog - Software development, architecture and more</title><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="Jordi AG blog about software, hardware, computer projects, ideas and tips."><link rel="preload" href="Mozcode%20Blog%20-%20Software%20development,%20architecture%20and%20more_files/site.js" as="script"><link rel="stylesheet" href="Mozcode%20Blog%20-%20Software%20development,%20architecture%20and%20more_files/belowthefold-mozcode.css"><noscript><link rel=stylesheet href="/css/belowthefold-mozcode.scss?v=xK40nFZwnTqydwc48-1ZcFQs2yI"></noscript><style>*{margin:0;padding:0;-webkit-box-sizing:border-box;box-sizing:border-box}html{min-height:100%;position:relative;-moz-text-size-adjust:none;-ms-text-size-adjust:none;-webkit-text-size-adjust:none;text-size-adjust:none;-ms-touch-action:manipulation;touch-action:manipulation}@font-face{font-family:'Karla';font-style:normal;font-weight:400;src:url("../fonts/karla-v8-latin-regular.eot?v=tp7wgfEs1B_YS6NGnN0jWVaN3QM");src:local("Karla"),local("Karla-Regular"),url("../fonts/karla-v8-latin-regular.eot?v=tp7wgfEs1B_YS6NGnN0jWVaN3QM&#iefix") format("embedded-opentype"),url("/fonts/karla-v8-latin-regular.woff2?v=HQyGKtlHxCwkmvZAZljgzfDjSog") format("woff2"),url("/fonts/karla-v8-latin-regular.woff?v=HQyGKtlHxCwkmvZAZljgzfDjSog") format("woff"),url("/fonts/karla-v8-latin-regular.ttf?v=OZzR7j-urs7lzNzKV6tiVgoEW4k") format("truetype"),url("/fonts/karla-v8-latin-regular.#Karla") format("svg")}@font-face{font-family:'blockoneicons';font-style:normal;font-weight:400;src:url("/fonts/blockoneicons-2-0-0.ttf?v=OZzR7j-urs7lzNzKV6tiVgoEW4k") format("truetype")}body{font:18px/1.4 "Karla",sans-serif;margin-bottom:40px;color:#222}.container{max-width:750px;margin:0 auto;padding:0 1.5em}.siteheader{text-align:left;padding:.8em 1.5em 2em 1.5em;height:225px;background-image:url(/img/header-background.png?v=H9bOvlF4v4AaW6u4hTIYFj-nIdM);background-color:#fff;background-repeat:repeat-x}.siteheader p{font-size:2em}.siteheader span{font-size:.9em}.siteheader a{color:#222;text-decoration:none}.header-banner{max-width:700px;height:90px;position:absolute;left:0;right:0;margin-left:auto;margin-right:auto;margin-top:0;background-image:url(/img/header-background.jpg?v=K8-iIArP5iqTfxVCnV2qAvusjT8);background-size:39em}.jordi-photo{width:145px;position:absolute;left:0;right:0;margin-left:auto;margin-right:auto;margin-top:17px;z-index:2}.jordi-photo-border{width:146px;height:146px;position:absolute;left:0;right:0;margin-left:auto;margin-right:auto;margin-top:16px;border-radius:50%;background:#ccc;z-index:1}.left-panel{float:left;top:120px;left:0;position:relative}.logo{width:40px;float:left;margin-left:-4px}.short-name{font-weight:bold}.central-panel{float:right;top:169px;position:relative}.social-navigation-menu li a i{font-family:'blockoneicons' !important;font-style:normal;color:#717f99}.social-navigation-menu li{margin-left:.625rem;list-style:none;display:list-item;float:left;list-style:none}.menu-bar{float:right;top:144px;position:relative}.menu-bar ul li{display:list-item;float:right;list-style:none;margin-left:.725rem;cursor:pointer}.separator{margin:auto;max-width:700px;height:1px;background-color:#ccc}.menu-bar ul li:hover{font-weight:bold}.social-navigation-menu li a i:hover{color:#091c42}.b1-icon-outline-github:before{content:""}.b1-icon-arrow-short-left:before{content:""}.b1-icon-arrow-short-right:before{content:""}.b1-icon-glyph-next:before{content:""}.b1-icon-chevron-right:before{content:""}.b1-icon-nav-arrow-right:before{content:""}.b1-icon-nav-arrow-left:before{content:""}.b1-icon-glyph-search-alt:before{content:"";position:relative;top:.2em}.b1-icon-glyph-volume-slash:before{content:""}.b1-icon-glyph-volume-up:before{content:""}.b1-icon-glyph-hashtag:before{content:""}.b1-icon-glyph-sync:before{content:""}.b1-icon-triangle-down:before{content:""}.b1-icon-social-rss:before{content:"";position:relative;right:-.0625em}.b1-icon-glyph-envelope:before{content:""}.b1-icon-glyph-print:before{content:""}.b1-icon-glyph-share:before{content:""}.b1-icon-social-instagram:before{content:""}.b1-icon-social-email:before{content:""}.b1-icon-social-github:before{content:""}.b1-icon-angle-left:before{content:""}.b1-icon-angle-right:before{content:""}.b1-icon-glyph-close:before{content:""}.b1-icon-glyph-plus:before{content:""}.b1-icon-arrow-down:before{content:""}.b1-icon-arrow-up:before{content:""}.b1-icon-arrow-left:before{content:""}.b1-icon-arrow-right:before{content:""}.b1-icon-askblockone:before{content:""}.b1-icon-blockone:before{content:""}.b1-icon-check:before{content:""}.b1-icon-clock:before{content:""}.b1-icon-collaboration:before{content:""}.b1-icon-eosio:before{content:""}.b1-icon-eosvc:before{content:""}.b1-icon-glyph-heart:before{content:""}.b1-icon-glyph-search:before{content:""}.b1-icon-graduation-cap:before{content:""}.b1-icon-map-marker-alt:before{content:""}.b1-icon-sitemap:before{content:""}.b1-icon-social-facebook:before{content:""}.b1-icon-social-linkedin:before{content:""}.b1-icon-social-medium:before{content:""}.b1-icon-social-twitter:before{content:""}.b1-icon-social-youtube:before{content:""}@keyframes fade-in{from{opacity:0}to{opacity:1}}main{animation:fade-in 1s ease;margin-top:30px}b,strong{font-weight:600}a{color:#0070be}a:hover,a:focus{text-decoration:none}img,iframe{max-width:100%}img{height:auto}h1,h2,h3,h4{font-weight:normal}ul,ol{padding-left:2em}time{color:#626262;font-size:.85em}.post{padding-bottom:2em;font-size:.9em}.post header h1{margin:.2em 0;line-height:1.3;font-size:1.3em;font-weight:bold;color:#222}.post header h1 a{color:#777;text-decoration:none}.post>div p{margin:1em 0;word-wrap:break-word;-moz-hyphens:auto;-ms-hyphens:auto;-webkit-hyphens:auto;hyphens:auto}.post>div img{padding:.5em}.post>div ul{list-style:none;text-indent:-1em}.post>div ul li:before{content:"»\20";opacity:.5;margin-right:.3em}.post>footer{border-top:1px solid #dfdfdf;border-bottom:1px solid #dfdfdf;padding-top:.5em;padding-bottom:.5em;margin-top:.5em;clear:both}.post h2,.post h3,.post h4,.post h5,.post h6{margin:1em 0 -.5em 0}.post blockquote{border-top:1px solid #dfdfdf;border-bottom:1px solid #dfdfdf;color:#6f6f6f;font-size:1.3em;width:90%;margin:1.5em auto;font-style:italic;font-weight:lighter}.post blockquote p{margin:1em .5em}.post pre{font-size:.9em;line-height:1.3;overflow:auto;padding:5px 10px;-ms-word-wrap:normal;word-wrap:normal;background:#f7f7f7;box-shadow:5px 5px 5px #dfdfdf}.post code{font-family:Menlo,Monaco,Consolas,"Courier New",monospace;font-size:.9em}.post table{font-size:.9em;border-collapse:collapse;font-variant-numeric:lining-nums tabular-nums;display:block;overflow-x:auto;white-space:nowrap}.post tr:nth-child(2n){background:#f7f7f7}.post th{border-bottom:1px solid #dfdfdf;text-align:left}.post td,.post th{padding:2px 7px}@media only screen and (max-width:640px){.siteheader span{display:none;padding:0}.siteheader span{padding:.8em 1.5em 2em 0}.central-panel{top:102px;width:123px;left:34px}.left-panel{width:182px;top:160px;left:-30px}.sitefooter p{top:1px}}@media only screen and (max-width:360px){.sitefooter p{font-size:.7em;top:1px}}</style><meta property="og:type" content="article"><meta property="og:title" content="Mozcode Blog - Software development, architecture and more"><meta property="og:description" content="Jordi AG blog about software, hardware, computer projects, ideas and tips."><meta property="og:url" content="https://www.mozcode.com/"><meta property="og:image" content="https://www.mozcode.com/img/icon512x512.png"><meta property="og:image:width" content="512"><meta property="og:image:height" content="512"><meta name="msapplication-square150x150logo" content="~/img/icon180x180.png"><link rel="icon" type="image/png" sizes="16x16" href="https://www.mozcode.com/img/icon16x16.png"><link rel="apple-touch-icon" href="Mozcode%20Blog%20-%20Software%20development,%20architecture%20and%20more_files/icon180x180.png"><link rel="shortcut icon" href="https://www.mozcode.com/img/icon16x16.png"><link rel="edituri" type="application/rsd+xml" title="RSD" href="https://www.mozcode.com/rsd.xml"><link rel="alternate" type="application/rss+xml" href="https://www.mozcode.com/feed/rss/"><link rel="alternate" type="application/atom+xml" href="https://www.mozcode.com/feed/atom/"><link rel="stylesheet" href="Mozcode%20Blog%20-%20Software%20development,%20architecture%20and%20more_files/dracula.css"><link rel="prev" href="https://www.mozcode.com/1/"><meta name="theme-color" content="#ffffff"><link rel="manifest" href="https://www.mozcode.com/manifest.webmanifest"></head><body itemscope="" itemtype="http://schema.org/WebPage"><div class="header-banner"></div> <div class="jordi-photo"><img src="Mozcode%20Blog%20-%20Software%20development,%20architecture%20and%20more_files/jordi.png" alt="Jordi"></div> <div class="jordi-photo-border"></div> <header class="siteheader"> <div class="container"> <div class="left-panel"> <img class="logo" src="Mozcode%20Blog%20-%20Software%20development,%20architecture%20and%20more_files/icon180x180.png" alt="logo"> <p itemprop="name" class="short-name"><a href="https://www.mozcode.com/">Mozcode</a></p> <span itemprop="description">Software development, architecture, tips and crazy ideas</span> </div> <div class="central-panel"> <ul class="social-navigation-menu"><li> <a href="https://twitter.com/jordimoz" target="_blank"><i class="b1-icon-social-twitter"></i></a> </li> <li> <a href="mailto:blog@mozcode.com" target="_blank"><i class="b1-icon-social-email"></i></a> </li> <li> <a href="https://www.instagram.com/jordimoz" target="_blank"><i class="b1-icon-social-instagram"></i></a> </li> <li> <a href="https://www.linkedin.com/in/jordiarquimbau/" target="_blank"><i class="b1-icon-social-linkedin"></i></a> </li>  <li> <a href="https://github.com/Jordiag" target="_blank"><i class="b1-icon-social-github"></i></a> </li> <li> <a href="https://www.mozcode.com/feed/rss" target="_blank"><i class="b1-icon-social-rss"></i></a> </li></ul> </div>  </div> </header> <div class="separator"></div> <main itemprop="mainEntity" itemscope="" itemtype="http://schema.org/Blog"> <noscript> <p class=container>Some features of this website do not work as expected when JavaScript is disabled</p> </noscript> <article class="post container" itemscope="" itemtype="http://schema.org/BlogPosting" itemprop="blogPost"> <header> <h1 itemprop="name headline"><a href="https://www.mozcode.com/blog/rasberry-pi-4-kubernetes-cluster-multi-master-ubuntu-kubespray/" rel="canonical" itemprop="url">RPi 4 K8s multi-master cluster using Ubuntu and Kubespray</a></h1> <time datetime="2020-01-25T06:14:46" itemprop="datePublished">Published Jan 25, 2020</time> </header> <div itemprop="articleBody mainEntityOfPage"> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <h2 style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong><img src="Mozcode%20Blog%20-%20Software%20development,%20architecture%20and%20more_files/banner-pi-cluster-kubespray_637155511290281352.jpg" alt="banner-pi-cluster-kubespray.jpg" class="loaded" width="700" height="200"><br></strong></h2> <h2 style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong>Introduction</strong></h2> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">Recently, I've been thinking about improving my <a title="10 Raspberry Pi 4 compact cluster hardware list" href="https://www.mozcode.com/blog/10-raspberry-pi-4-compact-cluster-hardware-list/" target="_blank" rel="noopener">Kubernetes (K8s) Raspberry Pi</a>
 cluster to&nbsp; something more resilient than just a one K8s master 
cluster which can fail easily and ruin all your work of months on it.</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">I installed multiple times on-premise <strong>single master K8s</strong>
 clusters based on Redhat ecosystem ( Centos/Fedora). The difficulty of 
doing this manually if it's your first time it's far from easy, and if 
you want to install something closer to an on premises HA K8s cluster 
manually it becomes a quite uncomfortable task.</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">So the challenge was to find a simple way to install a <strong>multi-master K8s</strong> cluster using my new 10 <strong>raspberry Pi 4</strong> (4Gb Ram) project.&nbsp;</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">This
 article intends to share my experience doing this task as a quick and 
easy guide for&nbsp; anybody who wants the same results without loosing 
hours on it. The hardware environment&nbsp; will consist in a simple 
network like this one:</div> <h2 style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><img src="Mozcode%20Blog%20-%20Software%20development,%20architecture%20and%20more_files/raspberry-pi-4-cluster-multi-master_637155534989372423.jpg" alt="raspberry-pi-4-cluster-multi-master.jpg" class="loaded" width="690" height="327"></h2> <h2 style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong>OS/Software stack</strong></h2> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol">The keys to reach this goal was to use:</span></div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol">- <strong>Kubespray </strong>K8s deployment tool.&nbsp;</span></span></div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol">- <strong>Ubuntu 18.04</strong> for <strong>Arm64</strong>.&nbsp;</span></span></span></div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol"><a title="Kubespray" href="https://kubespray.io/#/" target="_blank" rel="noopener">Kubespray</a>&nbsp;</span></span></span></span></span><span style="background-color:transparent">is a very good tool to ease your pain deploying <strong>highly available K8s clusters</strong>. It uses <strong>ansible playbooks</strong> and works with some major linux distributions, hardward platforms and&nbsp;</span><span style="background-color:transparent">cloud providers.</span></div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol">In the pre-installation you can configure&nbsp;</span></span></span></span></span><span style="background-color:transparent">your desired cluster&nbsp;</span><span style="background-color:transparent">structure, numer of masters and etcd replicated databases.</span></div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol">I
 tried some combinations of linux distributions and mostly all failed 
due it's difficult to find a linux distro that suits Kubespray 
requirements and the new Raspberry Pi 4 (4Gb RAM) hardware.<br></span></span></span></span></span></span>At this moment <strong>Raspbian</strong> it's compiled for Arm32<span style="background-color:transparent">/armhf and Kubespray will fail installing packages like calico,</span><span style="background-color:transparent">&nbsp;</span><span style="background-color:transparent"><a title="ETCD OS architecture support" href="https://etcd.io/docs/v3.3.12/op-guide/supported-platform/" target="_blank" rel="noopener">etcd has experimental support for arm32</a>, so better to use<strong> arm64</strong>.
 On the other side, Raspbian Arm64 is experimental and not officially 
supported by Kubespray so better not to use any of these distros yet, 
avoiding unexpected issues.<br><br></span><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol"><span style="background-color:transparent">The current latest <a title="Ubuntu 19.10 Preinstalled server" href="http://cdimage.ubuntu.com/ubuntu/releases/19.10/release/" target="_blank" rel="noopener"><strong>Ubuntu 19.10</strong> (Eoan Ermine) has a Preinstalled server</a> image&nbsp;for the new Raspberry Pi 4 compiled for arm64&nbsp;</span></span>&nbsp;but it's not supported officially by Kubespray and the installation can fail&nbsp;<span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol">so, maybe this distro will be a good candidate in near months.<br><br></span><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol">I wanted a <strong>long term support stable distro</strong> to avoid collateral issues I thought about <strong>Ubuntu 18.04 LTS</strong> which will be supported for 5 years until April 2023. But, the current official <a title="Ubuntu 18.04 LTS doesn't have a preinstalled server image" href="http://cdimage.ubuntu.com/ubuntu/releases/18.04.3/release/" target="_blank" rel="noopener">Ubuntu 18.04 LTS doesn't have a preinstalled server image</a>&nbsp;for the new Raspberry Pi 4, maybe they'll release it&nbsp;</span><span style="background-color:transparent">later,&nbsp;</span><span style="background-color:transparent">but now only Raspberry Pi 2/3 are supported.</span></div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol">While Ubuntu releases 18.04 LTS for <strong>Raspberry Pi 4 (Arm64)</strong> I found an <strong>unofficial</strong> preinstalled server image&nbsp;for Raspberry Pi 4, it works like a charm thanks to <a title="James Chchambers" href="https://twitter.com/jamesachambers" target="_blank" rel="noopener">James Chchambers</a>&nbsp;work:</span></div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><span style="font-family:Segoe UI VSS (Regular),Segoe UI,-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Helvetica,Ubuntu,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol"><a href="https://github.com/TheRemote/Ubuntu-Server-raspi4-unofficial" target="_blank" rel="noopener">https://github.com/TheRemote/Ubuntu-Server-raspi4-unofficial</a><br></span></div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">Using this unofficial distro you'll still be able to <strong>update Ubuntu linux packages from the Official repo</strong>, the only thing you'll have to care is about <strong>kernel packages</strong>, but how to block them will be explained below.</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <h2 style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong>Setting up Raspberry Pi 4 nodes</strong></h2> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">First let's install&nbsp;<span style="background-color:transparent">Ubuntu <strong>18.04 LTS for (Arm64)</strong> in all your&nbsp;</span><span style="background-color:transparent"><strong>Raspberry Pi 4</strong>. In my case I installed it in ten&nbsp;</span><span style="background-color:transparent">Raspberry
 Pi 4, for a multi-master installation the recommended minimum size is 
four raspberry pis (as shown in the picture above): two <strong>masters</strong>, two <strong>workers</strong> (three <strong>etcds</strong>, two in master nodes one in a worker node).</span></div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><span style="background-color:transparent">I'm going to suppose that your network range is 192.168.0.1/24, your raspberry ips are&nbsp;</span><span style="background-color:transparent">192.168.0.10-13, and your gateway is&nbsp;</span><span style="background-color:transparent">192.168.0.1, change them accordingly with your values in the scripts below.</span></div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong>1.</strong> <strong>Flash</strong> ubuntu 18.04 from&nbsp;<a href="https://github.com/TheRemote/Ubuntu-Server-raspi4-unofficial/releases/" target="_blank" rel="noopener">https://github.com/TheRemote/Ubuntu-Server-raspi4-unofficial/releases/</a>&nbsp;using <a title="balena Etcher" href="https://www.balena.io/etcher/" target="_blank" rel="noopener">balena Etcher</a> or any other similar "flash to sd" app to all your pi nodes.</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong>2.</strong> <strong>Boot</strong> your raspberry pi node with ubuntu 18.04 for the first time and change the default&nbsp; <em>ubuntu/ubuntu</em> user admin password.</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong>3.</strong> If you are in the United Kingdom, change your <strong>keyboard layout</strong> to gb:</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>sudo vi /etc/default/keyboard</code></pre> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">change XKBLAYOUT&nbsp;line to: XKBLAYOUT="gb"</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong>4.</strong> <strong>Update</strong> all packages</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>sudo apt-get update -y &amp;&amp; sudo apt-get --with-new-pkgs upgrade -y</code></pre> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong>5.</strong> Change your raspberry pi ip to static editing <em>/etc/netplan/50-cloud-init.yaml</em>&nbsp;, it should look like this one (changing ip address and gateway to your specific ones):</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code># This file is generated from information provided by
# the datasource.  Changes to it will not persist across an instance.
# To disable cloud-init's network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    ethernets:
        eth0:
            dhcp4: false
            match:
                macaddress: dd:a6:3a:1e:50:b9
            set-name: eth0
            addresses:
                - 192.168.0.10/24
            gateway4: 192.168.0.1
            nameservers:
                addresses: [1.1.1.1, 1.0.0.1]
    version: 2                                       </code></pre> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong>6.</strong> <strong>Block</strong> kernel packages to be upgraded from ubuntu official distribution</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>sudo apt-mark hold flash-kernel linux-raspi2 linux-image-raspi2 linux-headers-raspi2 linux-firmware-raspi2 linux-firmware</code></pre> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">&nbsp;</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong>7.</strong>&nbsp;<strong>Reboot</strong> and check all changes work ok.<br><br><strong>8.</strong> <strong>Repeat</strong> steps 1 to 7 for all raspberry pis.</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">&nbsp;</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <h2 style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong>Setting up a controller node</strong></h2> </div> </div> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">The first thing needed is a <strong>controller machine</strong> from where you're are going to install K8s to your <strong>Raspberry Pi cluster</strong>. I used my Windows 10 machine <a title="installing the Ubuntu 18.04 subsystem" href="https://linuxconfig.org/how-to-install-ubuntu-18-04-on-windows-10" target="_blank" rel="noopener">installing the Ubuntu 18.04 subsystem</a>.</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">Once you have a <strong>controller node ready</strong> you'll need to prepare it and install Kubespray on it. Open a linux terminal and follow the next steps.</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong>1.</strong> Generate a&nbsp;<span style="background-color:transparent"><strong>ssh key</strong> in your controller:</span></div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>ssh-keygen -t rsa</code></pre> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">It will be saved in /home/<em>your-username</em>/.ssh/id_rsa</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong>2.</strong> <strong>Copy</strong> your ssh key to<strong> all</strong> raspberry pi 4 nodes, repeat this command for all raspberry pi ips:</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>ssh-copy-id 192.168.0.10</code></pre> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">You'll get:</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><em>Are you sure you want to continue connecting (yes/no)? yes</em></div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">(answer your password)</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong>3.</strong> Edit /etc/sudoers in all pi nodes and add a line after the <em>%sudo</em> one to avoid password questions when using <strong>ssh</strong> to pi nodes from the controller node, replace <em>"your-controller-username"</em> by your real controller user name:</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code># Allow members of group sudo to execute any command
%sudo   ALL=(ALL:ALL) ALL
your-controller-username ALL=(ALL:ALL) NOPASSWD:ALL</code></pre> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong>4.</strong> Install&nbsp;<span style="background-color:transparent"><strong>python3</strong>, <strong>pip</strong> and <strong>git</strong> in your controller node:</span></div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>sudo apt install python3-pip git
sudo pip3 install --upgrade pip
pip --version</code></pre> <p>5. Add a function in your <strong>.bashrc</strong> script to be able to run commands to all raspberry pis at the same time:</p> <pre class="language-markup"><code>cd
nano .bashrc</code></pre> <p>Add <strong>this function</strong> at the end of the .bashrc file:</p> <pre class="language-markup"><code>function picmd {                                                                                                         
   echo "pi1"                                                                                                              
   ssh 192.168.0.10 "$@"                                                                                                   
   echo "pi2"                                                                                                              
   ssh 192.168.0.11 "$@"                                                                                                   
   echo "pi3"                                                                                                              
   ssh 192.168.0.12 "$@"                                                                                                   
   echo "pi4"                                                                                                              
   ssh 192.168.0.13 "$@"                                                                                                                                                                                                    }     </code></pre> <p>Apply <strong>.bashrc</strong> changes</p> <pre class="language-markup"><code>source .bashrc</code></pre> <p>Try it from your controller node writing: <strong>picmd date</strong>, you should see<strong> all pi node responses</strong>, something like this:</p> <pre class="language-markup"><code>ubuntu@CONTROLLER-NODE:~$ picmd date
pi1
Sat Jan 25 14:50:31 UTC 2020
pi2
Sat Jan 25 14:50:33 UTC 2020
pi3
Sat Jan 25 14:50:35 UTC 2020
pi4</code></pre> <p>You can now use picmd command to execute commands (like apt update) in all your raspberry pi nodes <strong>without logging in all of them one by one</strong>.</p> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <h2 style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">&nbsp;</h2> <h2 style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong>Installing Kubespray and the Kubernetes cluster</strong></h2> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">1. In your controller node home directory <strong>clone kubespray repo</strong>:</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>git clone https://github.com/kubernetes-sigs/kubespray.git</code></pre> <p>2. Enter into kubespray directory and take a look which <strong>kuberspray version</strong> are you going to install:</p> </div> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>cd kubespray/ &amp;&amp; git describe --tags </code></pre> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">It's <strong>important</strong> to know which kubespray version you are installing due kubespray <a title="kubespray upgrades" href="https://kubespray.io/#/docs/upgrades" target="_blank" rel="noopener">don't support upgrades&nbsp;from an older release straight to the latest release</a>, you have to upgrade it version after version without jumping any.</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">4. Install kubespray <strong>requirements</strong>:</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>sudo pip install -r requirements.txt</code></pre> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">5. Create a <strong>new inventory</strong> from the sample folder:</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>cp -rfp inventory/sample inventory/mycluster  </code></pre> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">6. Declare a <strong>IPS variable</strong> with all your raspberry cluster ips, for instance:</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>declare -a IPS=(192.168.0.10 192.168.0.11 192.168.0.12 92.168.0.13)</code></pre> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">7. Generate <strong>kubespray configuration</strong> based in your node ips:</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>CONFIG_FILE=inventory/mycluster/hosts.yml python3 contrib/inventory_builder/inventory.py ${IPS[@]}</code></pre> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">8. Review the generated <strong>hosts.yml file</strong>:</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>nano inventory/mycluster/hosts.yml</code></pre> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">In this file, in the 'hosts:' section, be aware that node1, node2, etc... will be the <strong>hostname</strong>
 of your raspberry pis based on the ips you provided. Kubespray will 
change them, if you prefer to name your raspberry pi hostnames 
differently, change them in this file. Initially, hosts.yml file should 
look like:</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>all:
  hosts:
    node1:
      ansible_host: 192.168.0.10
      ip: 192.168.0.10
      access_ip: 192.168.0.10
    node2:
      ansible_host: 192.168.0.11
      ip: 192.168.0.11
      access_ip: 192.168.0.11
    node3:
      ansible_host: 192.168.0.12
      ip: 192.168.0.12
      access_ip: 192.168.0.12
    node4:
      ansible_host: 192.168.0.13
      ip: 192.168.0.13
      access_ip: 192.168.0.13
  children:
    kube-master:
      hosts:
        node1:
        node2:
    kube-node:
      hosts:
        node1:
        node2:
        node3:
        node4:
    etcd:
      hosts:
        node1:
        node2:
        node3:
    k8s-cluster:
      children:
        kube-master:
        kube-node:
    calico-rr:
      hosts: {}
</code></pre> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">9. Optionally you can review other generated configuration files:</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>nano inventory/mycluster/group_vars/all/all.yml
nano inventory/mycluster/group_vars/k8s-cluster/k8s-cluster.yml</code></pre> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">10. Install your <strong>multi master Kubernetes cluster</strong> using kubespray:</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>ansible-playbook -i inventory/mycluster/hosts.yml --become --become-user=root cluster.yml</code></pre> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><span style="background-color:transparent">Kubespray</span>&nbsp;installation process can last several minutes or <strong>more than half an hour</strong> depending on your hardware and the configuration you set, relax and enjoy a cup of tea.</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">&nbsp;</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <h2 style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong>Manage your new cluster with Kubectl</strong></h2> </div> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">Let's install kubectl in your controller node to start playing with your new cluster. Download the latest <strong>kubectl</strong> version:</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl</code></pre> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">Make it an <strong>executable</strong> and move it to your <strong>bin directory</strong>:</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>sudo chmod +x kubectl
sudo mv kubectl /usr/local/bin/</code></pre> <p style="text-align:justify"><span style="color:#424242;font-family:Source Sans Pro,sans-serif"><span style="font-size:18px">Copy the <em>admin.conf</em> file from one of the <strong>master nodes</strong> to provide <strong>kubectl configuration</strong>.
 In the following bash commands replace the user name "ubuntu" by your 
controller username and the ip "192.168.0.1" with your master node ip:</span></span></p> <pre class="language-markup"><code>cd
ssh 192.168.0.1 sudo cp /etc/kubernetes/admin.conf /home/ubuntu/config
ssh 192.168.0.1 sudo chmod +r ~/config
scp 192.168.0.1:~/config .
mkdir .kube
mv config .kube/
ssh 192.168.0.1 sudo rm ~/config</code></pre> <p><span style="color:#424242;font-family:'Source Sans Pro',sans-serif;font-size:18px;text-align:justify">Now you should be able to <strong>list all your nodes and kubernetes pods</strong>:</span></p> <pre class="language-markup"><code>kubectl get nodes -o wide 
kubectl get pods -o wide --all-namespaces</code></pre> <p><strong>DONE!</strong></p> <p>&nbsp;</p> </div> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <h2 style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong>Classic error, number of masters and etcds databases</strong></h2> </div> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">If you are getting an error similar like this one:</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>[node3 -&gt; 192.168.0.12]: FAILED! =&gt; 
{"changed": true, 
"cmd": ["bash", "-x", 
"/usr/local/bin/etcd-scripts/make-ssl-etcd.sh", 
"-f", "/etc/ssl/etcd/openssl.conf", "-d", "/etc/ssl/etcd/ssl"], "delta": "0:00:00.007623", 
"end": "2019-12-21 13:10:13.140942", "msg": "non-zero return code", "rc": 127, "start": "2019-12-21 13:10:13.133319", 
"stderr": "bash: /usr/local/bin/etcd-scripts/make-ssl-etcd.sh: No such file or directory", 
"stderr_lines": ["bash: /usr/local/bin/etcd-scripts/make-ssl-etcd.sh: No such file or directory"], 
"stdout": "", 
"stdout_lines": []}</code></pre> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">It's because in your hosts.yml configuration the <strong>number of masters and etcd database nodes</strong> are wrong adjust them and launch kubespray installer again.</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">&nbsp;</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <h2 style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"><strong>Skip Kubespray packages upgrades</strong></h2> </div> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">In all your raspberry pi nodes, <strong>block</strong> to upgrade <strong>packages installed by Kubespray</strong>.
 When you upgrade your Kubernetes Kubespray cluster to a newer version, 
Kubespray will be in charge of update them too. Run this command in all 
your raspberry pi nodes:</div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px"> <pre class="language-markup"><code>sudo apt-mark hold apt-transport-https aufs-tools cgroupfs-mount containerd.io docker-ce docker-ce-cli ipset ipvsadm libipset3 libltdl7 libpython-stdlib libpython2-stdlib libpython2.7-minimal libpython2.7-stdlib pigz python python-apt python-minimal python2 python2-minimal python2.7 python2.7-minimal socat</code></pre> </div> <div style="box-sizing:border-box;background:transparent;margin-bottom:0;margin-top:14px">&nbsp;</div> </div> </div> </div> </div> <footer> <ul class="categories"><li> Posted in </li> <li itemprop="articleSection"><a href="https://www.mozcode.com/blog/category/raspberry-pi">raspberry-pi</a></li> <li itemprop="articleSection"><a href="https://www.mozcode.com/blog/category/kubernetes">kubernetes</a></li> <li itemprop="articleSection"><a href="https://www.mozcode.com/blog/category/kubespray">kubespray</a></li></ul> and has <a href="https://www.mozcode.com/blog/rasberry-pi-4-kubernetes-cluster-multi-master-ubuntu-kubespray/#comments" itemprop="discussionUrl" title="Go to the comments section"> <span itemprop="commentCount">0</span> comments </a><meta itemprop="author" content="Jordi AG"><meta itemprop="dateModified" content="2020-01-26T08:48:00"><meta itemprop="mainEntityOfPage" content="https://www.mozcode.com/blog/rasberry-pi-4-kubernetes-cluster-multi-master-ubuntu-kubespray/"></footer> </article> <article class="post container" itemscope="" itemtype="http://schema.org/BlogPosting" itemprop="blogPost"> <header> <h1 itemprop="name headline"><a href="https://www.mozcode.com/blog/10-raspberry-pi-4-compact-cluster-hardware-list/" rel="canonical" itemprop="url">10 Raspberry Pi 4 compact cluster hardware list</a></h1> <time datetime="2020-01-12T09:34:18" itemprop="datePublished">Published Jan 12, 2020</time> </header> <div itemprop="articleBody mainEntityOfPage"> <p>Months
 ago I decided to build a Raspberry pi 4 cluster to try some distributed
 software projects on it. The main goal was to build it in a compact way
 and as cheap as possible. Planning all hardware buying is not a 5 
minutes task so I thought about writing a short post.</p> <p>This post 
tries to save you time if you're looking for something similar pointing 
what and where to buy all the stuff required and have your Raspberry 4 
cluster ready to mount.</p> <p>I bought all the pieces mainly in two 
places EBay and AliExpress. Obviously it took two weeks to have all 
these pieces together after they came from UK and China.</p> <p>This is the summary of the required parts:</p> <table style="border-collapse:collapse;width:100%;height:233px" border="1"><tbody><tr style="height:18px;border-color:#ffffff"><td style="width:33.3333%;background-color:#91a3f2;height:18px;border-color:#ffffff">Part</td><td style="width:33.3333%;background-color:#91a3f2;height:18px;border-color:#ffffff">Shop</td><td style="width:33.3333%;background-color:#91a3f2;height:18px;border-color:#ffffff;text-align:left">price</td></tr><tr style="height:18px"><td style="width:33.3333%;height:18px">10 Raspberry Pi 4 (4Gb Ram)</td><td style="width:33.3333%;height:18px">EBay (auction)</td><td style="width:33.3333%;height:18px;text-align:right">£258.90</td></tr><tr style="height:18px"><td style="width:33.3333%;height:18px">10 Sandisk 16Gb SD Card</td><td style="width:33.3333%;height:18px">AliExpress</td><td style="width:33.3333%;height:18px;text-align:right">£20.87</td></tr><tr style="height:18px"><td style="width:33.3333%;height:18px">10 USB Charger 3.5A 5V</td><td style="width:33.3333%;height:18px">AliExpress</td><td style="width:33.3333%;height:18px;text-align:right">£17.27</td></tr><tr style="height:18px"><td style="width:33.3333%;height:18px">10 EU female socket</td><td style="width:33.3333%;height:18px">AliExpress</td><td style="width:33.3333%;height:18px;text-align:right">£9.58</td></tr><tr style="height:18px"><td style="width:33.3333%;height:18px">10 CAT6 RJ45 network cable</td><td style="width:33.3333%;height:18px">AliExpress</td><td style="width:33.3333%;height:18px;text-align:right">£7.44</td></tr><tr style="height:18px"><td style="width:33.3333%;height:18px">2 Gigabit 8 port switches</td><td style="width:33.3333%;height:18px">AliExpress</td><td style="width:33.3333%;height:18px;text-align:right">£21.08</td></tr><tr style="height:18px"><td style="width:33.3333%;height:18px">2 Acrylic 5 stack Rpi4 case</td><td style="width:33.3333%;height:18px">AliExpress</td><td style="width:33.3333%;height:18px;text-align:right">£25.31</td></tr><tr style="height:18px"><td style="width:33.3333%;height:18px">10 USB-A to USB-C cable&nbsp;</td><td style="width:33.3333%;height:18px">EBay (shop)</td><td style="width:33.3333%;height:18px;text-align:right">£7.89</td></tr><tr style="height:18px"><td style="width:33.3333%;height:18px">10 CPU &amp; chipset coolers</td><td style="width:33.3333%;height:18px">EBay (shop)</td><td style="width:33.3333%;text-align:right;height:18px">£8.04</td></tr><tr style="height:17px"><td style="width:33.3333%;height:17px">1 pack Nylon Cable Ties</td><td style="width:33.3333%;height:17px">EBay (shop)</td><td style="width:33.3333%;text-align:right;height:17px">£2.49</td></tr><tr style="height:18px"><td style="width:33.3333%;height:18px">1 4 meter Electrical cable</td><td style="width:33.3333%;height:18px">EBay (shop)</td><td style="width:33.3333%;text-align:right;height:18px">£4.94</td></tr><tr style="height:18px"><td style="width:33.3333%;height:18px">2 UK 3A fused plugs</td><td style="width:33.3333%;height:18px">Robert Dyas</td><td style="width:33.3333%;height:18px;text-align:right">£2.58</td></tr></tbody></table> <p><br>This is the detailed item list from AliExpress:&nbsp;</p> <p><a title="AliExpress raspberry pi 4 cluster items" href="https://www.mozcode.com/posts/files/fixed/AliExpress-raspberry-pi-4-cluster.png" target="_blank" rel="noopener"><img src="Mozcode%20Blog%20-%20Software%20development,%20architecture%20and%20more_files/AliExpress-raspberry-pi-4-cluster_637144527955013887.jpg" alt="AliExpress-raspberry-pi-4-cluster" class="loaded" width="975" height="1948"></a></p> <p><br>This is the detailed item list from EBay:</p> <p><a title="raspberry pi 4 cluster ebay item list" href="https://www.mozcode.com/posts/files/fixed/raspberry-pi-4-cluster-ebay-list.png" target="_blank" rel="noopener"><img src="Mozcode%20Blog%20-%20Software%20development,%20architecture%20and%20more_files/raspberry-pi-4-cluster-ebay-list_637144544139535355.jpg" alt="raspberry-pi-4-cluster-ebay-list" class="loaded" width="1011" height="2072"></a></p> <p>The
 trick to have 10 Raspberry Pi 4 (4Gb) at a really good price was to 
find an auction of 10 brand new of them, if you're not that lucky you 
can buy them in E-bay currently at around £43 each.&nbsp;<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="/Posts/files/10-raspberry-pi-4_637144545157502264.jpg" alt="10-raspberry-pi-4.jpg" width="1500" height="844"></p> <p>After mounting all the pieces this is the result:&nbsp;</p> <p><a title="raspberry pi 4 cluster front view" href="https://www.mozcode.com/posts/files/fixed/raspberry-pi-4-cluster-front-view.jpg" target="_blank" rel="noopener"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="/Posts/files/raspberry-pi-4-cluster-front-view_637144547269281931.jpg" alt="raspberry-pi-4-cluster-front-view.jpg" width="1500" height="844"></a></p> <p><a title="raspberry pi 4 cluster lateral view" href="https://www.mozcode.com/posts/files/fixed/raspberry-pi-4-cluster-lateral-view.jpg" target="_blank" rel="noopener"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="/Posts/files/raspberry-pi-4-cluster-lateral-view_637144550279014566.jpg" alt="raspberry-pi-4-cluster-lateral-view.jpg" width="1500" height="844"></a></p> <p><a title="raspberry pi 4 cluster rear view" href="https://www.mozcode.com/posts/files/fixed/raspberry-pi-4-cluster-rear-view.jpg" target="_blank" rel="noopener"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="/Posts/files/raspberry-pi-4-cluster-rear-view_637144550279693578.jpg" alt="raspberry-pi-4-cluster-rear-view.jpg" width="1500" height="844"></a></p> <p><a title="raspberry pi 4 cluster top view" href="https://www.mozcode.com/posts/files/fixed/raspberry-pi-4-cluster-top-view.jpg" target="_blank" rel="noopener"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="/Posts/files/raspberry-pi-4-cluster-top-view_637144550280199870.jpg" alt="raspberry-pi-4-cluster-top-view.jpg" width="1500" height="844"></a></p> <p>This
 was a short post, Just an excuse to start my new 2020 blog with it. I 
hope you like it, more posts are coming related to projects using this 
raspberry pi 4 cluster and other interesting stuff.</p> <p>Thank you for reading ;)</p> </div> <footer> <ul class="categories"><li> Posted in </li> <li itemprop="articleSection"><a href="https://www.mozcode.com/blog/category/raspberry-pi">raspberry-pi</a></li></ul> and has <a href="https://www.mozcode.com/blog/10-raspberry-pi-4-compact-cluster-hardware-list/#comments" itemprop="discussionUrl" title="Go to the comments section"> <span itemprop="commentCount">0</span> comments </a><meta itemprop="author" content="Jordi AG"><meta itemprop="dateModified" content="2020-01-15T14:07:45"><meta itemprop="mainEntityOfPage" content="https://www.mozcode.com/blog/10-raspberry-pi-4-compact-cluster-hardware-list/"></footer> </article> <nav class="pagination container" aria-label="Pagination"> <a rel="prev" href="https://www.mozcode.com/1/" title="Older posts">« Older</a> <br><br> </nav> </main> <footer class="sitefooter"> <div class="container"> <p> © 2020 Jordi AG - Blog | Handmade from London, UK | Powered by a <a href="https://github.com/Jordiag/Miniblog.Core/tree/mozcode" rel="noopener noreferrer" target="_blank">forked version</a> of <a href="https://github.com/madskristensen/Miniblog.Core" rel="noopener noreferrer" target="_blank">Miniblog.Core</a> </p> </div> </footer><link rel="stylesheet" href="Mozcode%20Blog%20-%20Software%20development,%20architecture%20and%20more_files/belowthefold-mozcode.css"><noscript><link rel=stylesheet href="/css/belowthefold-mozcode.scss?v=xK40nFZwnTqydwc48-1ZcFQs2yI"></noscript><script src="Mozcode%20Blog%20-%20Software%20development,%20architecture%20and%20more_files/site.js" async="" defer="defer"></script><script src="Mozcode%20Blog%20-%20Software%20development,%20architecture%20and%20more_files/highlight.js"></script><script>hljs.initHighlightingOnLoad();</script><script>'serviceWorker'in navigator&&navigator.serviceWorker.register('/serviceworker',{scope:'/'})</script></body></html>